# 校园购物商城概要设计文档

## 1. 文档概述

### 1.1 文档目的
本文档基于校园购物商城需求说明书，详细描述系统的架构设计、模块划分、关键类设计、接口设计等内容，为详细设计和开发提供指导。

### 1.2 术语定义
- **前端**：使用Vue.js开发的用户界面层
- **后端**：使用Spring Boot开发的业务逻辑层和数据访问层
- **微服务**：将系统拆分为多个独立的服务，每个服务专注于特定的业务功能
- **RESTful API**：一种基于HTTP的API设计风格，使用GET、POST、PUT、DELETE等方法操作资源
- **JWT**：JSON Web Token，用于用户身份认证和授权
- **Docker**：容器化平台，用于应用程序的打包和部署

## 2. 系统架构设计

### 2.1 整体架构
系统采用前后端分离的架构设计，主要分为以下几层：

1. **前端层**：使用Vue.js + Element Plus构建用户界面
2. **API网关层**：使用Nginx作为反向代理，处理请求路由、负载均衡等
3. **应用服务层**：使用Spring Boot实现业务逻辑
4. **数据访问层**：使用MyBatis操作MySQL数据库
5. **数据存储层**：MySQL数据库存储业务数据

### 2.2 技术架构

#### 2.2.1 前端技术栈
- **框架**：Vue.js 3.x
- **构建工具**：Vite
- **UI组件库**：Element Plus
- **路由管理**：Vue Router
- **HTTP客户端**：Axios
- **状态管理**：Pinia

#### 2.2.2 后端技术栈
- **框架**：Spring Boot 2.x / Spring MVC
- **ORM框架**：MyBatis
- **数据库**：MySQL 8.x
- **认证授权**：Spring Security + JWT
- **文件上传**：Spring MultipartFile
- **跨域处理**：全局CORS配置

#### 2.2.3 部署技术栈
- **容器化**：Docker + Docker Compose
- **Web服务器**：Nginx
- **版本控制**：Git

### 2.3 系统分层

#### 2.3.1 前端分层
1. **表现层**：Vue组件，负责页面展示
2. **业务层**：Vuex/Pinia，负责状态管理和业务逻辑
3. **数据层**：Axios，负责与后端API交互

#### 2.3.2 后端分层
1. **Controller层**：处理HTTP请求，返回响应
2. **Service层**：实现业务逻辑
3. **Mapper层**：负责数据库操作
4. **Entity层**：数据实体类
5. **DTO层**：数据传输对象
6. **Util层**：工具类

## 3. 模块划分

### 3.1 前端模块

| 模块名称 | 主要功能 | 技术实现 |
| :--- | :--- | :--- |
| **公共模块** | 路由配置、拦截器、工具函数 | Vue Router、Axios拦截器 |
| **用户模块** | 登录、注册、个人中心 | Vue组件、Pinia |
| **商品模块** | 商品列表、商品详情、搜索 | Vue组件、Element Plus |
| **购物车模块** | 购物车管理、结算 | Vue组件、Pinia |
| **订单模块** | 订单列表、订单详情、支付 | Vue组件、第三方支付SDK |
| **评价模块** | 商品评价、评价列表 | Vue组件 |
| **管理员模块** | 用户管理、商品管理、订单管理 | Vue组件、Element Plus |

### 3.2 后端模块

| 模块名称 | 主要功能 | 包路径 |
| :--- | :--- | :--- |
| **公共模块** | 配置类、工具类、异常处理 | com.shopping.common |
| **用户模块** | 用户认证、用户管理 | com.shopping.user |
| **商品模块** | 商品管理、分类管理 | com.shopping.product |
| **购物车模块** | 购物车管理 | com.shopping.cart |
| **订单模块** | 订单管理、支付处理 | com.shopping.order |
| **评价模块** | 评价管理 | com.shopping.review |
| **管理员模块** | 管理员认证、后台管理 | com.shopping.admin |
| **API模块** | RESTful API接口 | com.shopping.api |

## 4. 关键类设计

### 4.1 核心实体类

#### 4.1.1 用户相关
- **User**：用户实体类
  - id：用户ID
  - username：用户名
  - password：密码
  - phone：手机号
  - email：邮箱
  - avatar：头像
  - createTime：创建时间
  - updateTime：更新时间

- **Address**：收货地址实体类
  - id：地址ID
  - userId：用户ID
  - consignee：收货人
  - phone：收货人电话
  - province：省份
  - city：城市
  - district：区县
  - detailAddress：详细地址
  - isDefault：是否默认

#### 4.1.2 商品相关
- **Category**：商品分类实体类
  - id：分类ID
  - name：分类名称
  - parentId：父分类ID
  - level：分类级别
  - sort：排序
  - status：状态

- **Product**：商品实体类
  - id：商品ID
  - name：商品名称
  - price：价格
  - stock：库存
  - description：描述
  - images：商品图片
  - categoryId：分类ID
  - status：状态
  - sales：销量
  - createTime：创建时间
  - updateTime：更新时间

#### 4.1.3 购物车相关
- **Cart**：购物车实体类
  - id：购物车ID
  - userId：用户ID
  - productId：商品ID
  - quantity：数量
  - createTime：创建时间
  - updateTime：更新时间

#### 4.1.4 订单相关
- **Order**：订单实体类
  - id：订单ID
  - orderNo：订单号
  - userId：用户ID
  - totalPrice：总价格
  - status：订单状态
  - addressId：收货地址ID
  - paymentMethod：支付方式
  - paymentTime：支付时间
  - deliveryTime：发货时间
  - endTime：完成时间
  - createTime：创建时间
  - updateTime：更新时间

- **OrderItem**：订单项实体类
  - id：订单项ID
  - orderId：订单ID
  - productId：商品ID
  - productName：商品名称
  - productPrice：商品价格
  - quantity：数量
  - totalPrice：小计

#### 4.1.5 管理员相关
- **Admin**：管理员实体类
  - id：管理员ID
  - username：用户名
  - password：密码
  - name：姓名
  - phone：电话
  - role：角色
  - status：状态
  - createTime：创建时间
  - updateTime：更新时间

### 4.2 核心业务类

#### 4.2.1 用户服务
- **UserService**：用户服务接口
- **UserServiceImpl**：用户服务实现类

#### 4.2.2 商品服务
- **ProductService**：商品服务接口
- **ProductServiceImpl**：商品服务实现类
- **CategoryService**：分类服务接口
- **CategoryServiceImpl**：分类服务实现类

#### 4.2.3 购物车服务
- **CartService**：购物车服务接口
- **CartServiceImpl**：购物车服务实现类

#### 4.2.4 订单服务
- **OrderService**：订单服务接口
- **OrderServiceImpl**：订单服务实现类
- **PaymentService**：支付服务接口
- **PaymentServiceImpl**：支付服务实现类

#### 4.2.5 评价服务
- **ReviewService**：评价服务接口
- **ReviewServiceImpl**：评价服务实现类

#### 4.2.6 管理员服务
- **AdminService**：管理员服务接口
- **AdminServiceImpl**：管理员服务实现类

### 4.3 数据访问类

- **UserMapper**：用户数据访问接口
- **CategoryMapper**：分类数据访问接口
- **ProductMapper**：商品数据访问接口
- **CartMapper**：购物车数据访问接口
- **OrderMapper**：订单数据访问接口
- **OrderItemMapper**：订单项数据访问接口
- **AdminMapper**：管理员数据访问接口

### 4.4 控制器类

- **UserController**：用户控制器
- **ProductController**：商品控制器
- **CartController**：购物车控制器
- **OrderController**：订单控制器
- **PaymentController**：支付控制器
- **ReviewController**：评价控制器
- **AdminController**：管理员控制器

### 4.5 工具类

- **JwtUtils**：JWT工具类
- **PasswordUtils**：密码加密工具类
- **FileUtils**：文件处理工具类
- **DateUtils**：日期处理工具类
- **ResponseUtils**：响应处理工具类

## 5. 接口设计

### 5.1 RESTful API设计规范

#### 5.1.1 URL规范
- 基础URL：`/api/v1/{模块名}/{资源名}`
- 示例：`/api/v1/products`, `/api/v1/orders/123`

#### 5.1.2 HTTP方法使用规范
- **GET**：获取资源
- **POST**：创建资源
- **PUT**：更新资源
- **DELETE**：删除资源
- **PATCH**：部分更新资源

#### 5.1.3 响应格式规范
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 5.2 核心API接口

#### 5.2.1 用户模块API
- **POST /api/v1/auth/register**：用户注册
- **POST /api/v1/auth/login**：用户登录
- **POST /api/v1/auth/logout**：用户登出
- **GET /api/v1/users/profile**：获取用户信息
- **PUT /api/v1/users/profile**：更新用户信息
- **POST /api/v1/users/password**：修改密码
- **POST /api/v1/users/addresses**：添加收货地址
- **GET /api/v1/users/addresses**：获取收货地址列表
- **PUT /api/v1/users/addresses/{id}**：更新收货地址
- **DELETE /api/v1/users/addresses/{id}**：删除收货地址

#### 5.2.2 商品模块API
- **GET /api/v1/categories**：获取商品分类列表
- **GET /api/v1/products**：获取商品列表（支持分页、筛选、排序）
- **GET /api/v1/products/{id}**：获取商品详情
- **GET /api/v1/products/search**：搜索商品
- **GET /api/v1/products/recommend**：获取推荐商品

#### 5.2.3 购物车模块API
- **GET /api/v1/carts**：获取购物车列表
- **POST /api/v1/carts**：添加商品到购物车
- **PUT /api/v1/carts/{id}**：更新购物车商品数量
- **DELETE /api/v1/carts/{id}**：从购物车移除商品
- **DELETE /api/v1/carts**：清空购物车

#### 5.2.4 订单模块API
- **POST /api/v1/orders**：创建订单
- **GET /api/v1/orders**：获取订单列表（支持分页、状态筛选）
- **GET /api/v1/orders/{id}**：获取订单详情
- **PUT /api/v1/orders/{id}/cancel**：取消订单
- **PUT /api/v1/orders/{id}/confirm**：确认收货
- **POST /api/v1/orders/{id}/refund**：申请退款

#### 5.2.5 支付模块API
- **POST /api/v1/payments/{orderId}**：创建支付订单
- **GET /api/v1/payments/{orderId}/status**：查询支付状态
- **POST /api/v1/payments/callback**：支付回调处理

#### 5.2.6 评价模块API
- **POST /api/v1/reviews**：添加商品评价
- **GET /api/v1/reviews/product/{productId}**：获取商品评价列表
- **GET /api/v1/reviews/user**：获取用户评价列表

#### 5.2.7 管理员模块API
- **POST /api/v1/admin/auth/login**：管理员登录
- **GET /api/v1/admin/users**：获取用户列表
- **PUT /api/v1/admin/users/{id}/status**：修改用户状态
- **GET /api/v1/admin/products**：获取商品列表
- **POST /api/v1/admin/products**：添加商品
- **PUT /api/v1/admin/products/{id}**：更新商品
- **DELETE /api/v1/admin/products/{id}**：删除商品
- **GET /api/v1/admin/orders**：获取订单列表
- **PUT /api/v1/admin/orders/{id}/status**：修改订单状态

## 6. 数据库设计概述

### 6.1 数据库表结构
系统包含以下核心数据表：
1. **user**：用户表
2. **category**：商品分类表
3. **product**：商品表
4. **cart**：购物车表
5. **orders**：订单表
6. **order_item**：订单项表
7. **admin**：管理员表

详细的数据库设计请参考《数据库设计文档》。

### 6.2 数据关系图
![数据关系图](数据关系图.png)

## 7. 安全性设计

### 7.1 认证与授权
- 使用JWT进行身份认证
- 基于Spring Security实现授权控制
- 密码使用BCrypt加密存储

### 7.2 数据安全
- 敏感数据加密传输（HTTPS）
- 数据脱敏处理
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护

### 7.3 日志审计
- 记录关键操作日志
- 记录登录日志
- 记录异常日志

## 8. 部署架构设计

### 8.1 开发环境
- 前端：Node.js + Vue CLI
- 后端：JDK 11 + Spring Boot + MySQL
- 开发工具：IntelliJ IDEA / VS Code

### 8.2 测试环境
- Docker Compose编排多容器应用
- 包含前端、后端、数据库等容器

### 8.3 生产环境
- Nginx作为反向代理
- Docker容器化部署
- 数据库主从复制
- 负载均衡

## 9. 性能优化策略

### 9.1 前端优化
- 资源压缩和缓存
- 懒加载
- 组件按需加载
- CDN加速

### 9.2 后端优化
- 数据库索引优化
- 缓存机制（Redis）
- 连接池优化
- 异步处理
- 代码优化

## 10. 附录

### 10.1 相关文档
- 需求说明书
- 详细设计文档
- 数据库设计文档
- 测试计划文档

### 10.2 参考资料
- Vue.js官方文档
- Spring Boot官方文档
- MyBatis官方文档
- RESTful API设计指南